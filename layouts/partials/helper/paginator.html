{{- $pages := "" -}}

{{- if .IsHome -}}
    {{ $pages = where .Site.RegularPages "Section" "in" .Site.Params.mainSections }}
    {{ $pages = where $pages "Params.hidden" "!=" true }}
{{- else if eq .Kind "term" -}}
    {{ $pages = where .Pages "Params.hidden" "!=" true }}
{{- else if or (eq .Kind "section") (eq .Kind "taxonomy") -}}
    {{ $subsections := .Sections }}
    {{ $pages = .Pages | complement $subsections }}
    {{ $pages = where $pages "Params.hidden" "!=" true }}

    {{- if eq (len $pages) 0 -}}
        {{/* See complete logic in list.html */}}
        {{- $pages = $subsections -}}
    {{- end -}}
{{- end -}}

{{/* Only paginate on list pages that support pagination */}}
{{- $result := "" -}}
{{- if or .IsHome (eq .Kind "section") (eq .Kind "taxonomy") (eq .Kind "term") -}}
    {{- if not $pages -}}
        {{- $pages = slice -}}
    {{- end -}}
    {{- $result = .Paginate $pages -}}
{{- end -}}

{{ return $result }}
